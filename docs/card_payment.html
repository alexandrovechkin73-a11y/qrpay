<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Card Payment</title>
    <style>
      body{font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;margin:0;padding:16px;background:#fff}
      #dropin-container{margin-top:16px}
      button{width:100%;height:44px;border-radius:8px;border:0;background:#111;color:#fff;font-weight:600}
    </style>
    <script src="https://js.braintreegateway.com/web/dropin/1.42.0/js/dropin.min.js"></script>
  </head>
  <body>
    <h3>Pay with card</h3>
    <div id="dropin-container"></div>
    <div style="height:12px"></div>
    <button id="pay">Pay</button>
    <script>
      const token = decodeURIComponent(location.hash.slice(1));
      let dropinInstance;
      braintree.dropin.create({
        authorization: token,
        container: '#dropin-container'
      }, function (createErr, instance) {
        if (createErr) {
          alert('Drop-in error: '+ createErr);
          return;
        }
        dropinInstance = instance;
      });

      document.getElementById('pay').addEventListener('click', async () => {
        if (!dropinInstance) return;
        try {
          const payload = await dropinInstance.requestPaymentMethod();
          const nonce = payload.nonce;
          window.opener && window.opener.postMessage({ type: 'braintreeNonce', nonce }, '*');
        } catch (e) {
          alert('Payment error: ' + e);
        }
      });
    </script>
  </body>
  </html>


